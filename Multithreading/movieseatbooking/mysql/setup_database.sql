-- Movie Seat Booking Database Setup
-- This script creates tables and inserts sample data for demonstrating different locking strategies

-- Create database if not exists
CREATE DATABASE IF NOT EXISTS movie_booking_demo;
USE movie_booking_demo;

-- Drop tables if they exist
DROP TABLE IF EXISTS bookings;
DROP TABLE IF EXISTS seats;
DROP TABLE IF EXISTS movies;
DROP TABLE IF EXISTS users;

-- Create users table
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Create movies table
CREATE TABLE movies (
    id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(200) NOT NULL,
    duration_minutes INT NOT NULL,
    release_date DATE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Create seats table (matching the exact schema from screenshots)
CREATE TABLE seats (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL,
    movie_id INT NOT NULL,
    user_id INT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (movie_id) REFERENCES movies(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- Create bookings table (for audit trail)
CREATE TABLE bookings (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    seat_id INT NOT NULL,
    movie_id INT NOT NULL,
    booking_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (seat_id) REFERENCES seats(id),
    FOREIGN KEY (movie_id) REFERENCES movies(id)
);

-- Insert 1 movie
INSERT INTO movies (title, duration_minutes, release_date) VALUES 
('The Multithreading Adventure', 120, '2024-01-15');

-- Insert 200 random users
INSERT INTO users (username, email) VALUES
('user001', 'user001@example.com'),
('user002', 'user002@example.com'),
('user003', 'user003@example.com'),
('user004', 'user004@example.com'),
('user005', 'user005@example.com'),
('user006', 'user006@example.com'),
('user007', 'user007@example.com'),
('user008', 'user008@example.com'),
('user009', 'user009@example.com'),
('user010', 'user010@example.com'),
('user011', 'user011@example.com'),
('user012', 'user012@example.com'),
('user013', 'user013@example.com'),
('user014', 'user014@example.com'),
('user015', 'user015@example.com'),
('user016', 'user016@example.com'),
('user017', 'user017@example.com'),
('user018', 'user018@example.com'),
('user019', 'user019@example.com'),
('user020', 'user020@example.com'),
('user021', 'user021@example.com'),
('user022', 'user022@example.com'),
('user023', 'user023@example.com'),
('user024', 'user024@example.com'),
('user025', 'user025@example.com'),
('user026', 'user026@example.com'),
('user027', 'user027@example.com'),
('user028', 'user028@example.com'),
('user029', 'user029@example.com'),
('user030', 'user030@example.com'),
('user031', 'user031@example.com'),
('user032', 'user032@example.com'),
('user033', 'user033@example.com'),
('user034', 'user034@example.com'),
('user035', 'user035@example.com'),
('user036', 'user036@example.com'),
('user037', 'user037@example.com'),
('user038', 'user038@example.com'),
('user039', 'user039@example.com'),
('user040', 'user040@example.com'),
('user041', 'user041@example.com'),
('user042', 'user042@example.com'),
('user043', 'user043@example.com'),
('user044', 'user044@example.com'),
('user045', 'user045@example.com'),
('user046', 'user046@example.com'),
('user047', 'user047@example.com'),
('user048', 'user048@example.com'),
('user049', 'user049@example.com'),
('user050', 'user050@example.com'),
('user051', 'user051@example.com'),
('user052', 'user052@example.com'),
('user053', 'user053@example.com'),
('user054', 'user054@example.com'),
('user055', 'user055@example.com'),
('user056', 'user056@example.com'),
('user057', 'user057@example.com'),
('user058', 'user058@example.com'),
('user059', 'user059@example.com'),
('user060', 'user060@example.com'),
('user061', 'user061@example.com'),
('user062', 'user062@example.com'),
('user063', 'user063@example.com'),
('user064', 'user064@example.com'),
('user065', 'user065@example.com'),
('user066', 'user066@example.com'),
('user067', 'user067@example.com'),
('user068', 'user068@example.com'),
('user069', 'user069@example.com'),
('user070', 'user070@example.com'),
('user071', 'user071@example.com'),
('user072', 'user072@example.com'),
('user073', 'user073@example.com'),
('user074', 'user074@example.com'),
('user075', 'user075@example.com'),
('user076', 'user076@example.com'),
('user077', 'user077@example.com'),
('user078', 'user078@example.com'),
('user079', 'user079@example.com'),
('user080', 'user080@example.com'),
('user081', 'user081@example.com'),
('user082', 'user082@example.com'),
('user083', 'user083@example.com'),
('user084', 'user084@example.com'),
('user085', 'user085@example.com'),
('user086', 'user086@example.com'),
('user087', 'user087@example.com'),
('user088', 'user088@example.com'),
('user089', 'user089@example.com'),
('user090', 'user090@example.com'),
('user091', 'user091@example.com'),
('user092', 'user092@example.com'),
('user093', 'user093@example.com'),
('user094', 'user094@example.com'),
('user095', 'user095@example.com'),
('user096', 'user096@example.com'),
('user097', 'user097@example.com'),
('user098', 'user098@example.com'),
('user099', 'user099@example.com'),
('user100', 'user100@example.com'),
('user101', 'user101@example.com'),
('user102', 'user102@example.com'),
('user103', 'user103@example.com'),
('user104', 'user104@example.com'),
('user105', 'user105@example.com'),
('user106', 'user106@example.com'),
('user107', 'user107@example.com'),
('user108', 'user108@example.com'),
('user109', 'user109@example.com'),
('user110', 'user110@example.com'),
('user111', 'user111@example.com'),
('user112', 'user112@example.com'),
('user113', 'user113@example.com'),
('user114', 'user114@example.com'),
('user115', 'user115@example.com'),
('user116', 'user116@example.com'),
('user117', 'user117@example.com'),
('user118', 'user118@example.com'),
('user119', 'user119@example.com'),
('user120', 'user120@example.com'),
('user121', 'user121@example.com'),
('user122', 'user122@example.com'),
('user123', 'user123@example.com'),
('user124', 'user124@example.com'),
('user125', 'user125@example.com'),
('user126', 'user126@example.com'),
('user127', 'user127@example.com'),
('user128', 'user128@example.com'),
('user129', 'user129@example.com'),
('user130', 'user130@example.com'),
('user131', 'user131@example.com'),
('user132', 'user132@example.com'),
('user133', 'user133@example.com'),
('user134', 'user134@example.com'),
('user135', 'user135@example.com'),
('user136', 'user136@example.com'),
('user137', 'user137@example.com'),
('user138', 'user138@example.com'),
('user139', 'user139@example.com'),
('user140', 'user140@example.com'),
('user141', 'user141@example.com'),
('user142', 'user142@example.com'),
('user143', 'user143@example.com'),
('user144', 'user144@example.com'),
('user145', 'user145@example.com'),
('user146', 'user146@example.com'),
('user147', 'user147@example.com'),
('user148', 'user148@example.com'),
('user149', 'user149@example.com'),
('user150', 'user150@example.com'),
('user151', 'user151@example.com'),
('user152', 'user152@example.com'),
('user153', 'user153@example.com'),
('user154', 'user154@example.com'),
('user155', 'user155@example.com'),
('user156', 'user156@example.com'),
('user157', 'user157@example.com'),
('user158', 'user158@example.com'),
('user159', 'user159@example.com'),
('user160', 'user160@example.com'),
('user161', 'user161@example.com'),
('user162', 'user162@example.com'),
('user163', 'user163@example.com'),
('user164', 'user164@example.com'),
('user165', 'user165@example.com'),
('user166', 'user166@example.com'),
('user167', 'user167@example.com'),
('user168', 'user168@example.com'),
('user169', 'user169@example.com'),
('user170', 'user170@example.com'),
('user171', 'user171@example.com'),
('user172', 'user172@example.com'),
('user173', 'user173@example.com'),
('user174', 'user174@example.com'),
('user175', 'user175@example.com'),
('user176', 'user176@example.com'),
('user177', 'user177@example.com'),
('user178', 'user178@example.com'),
('user179', 'user179@example.com'),
('user180', 'user180@example.com'),
('user181', 'user181@example.com'),
('user182', 'user182@example.com'),
('user183', 'user183@example.com'),
('user184', 'user184@example.com'),
('user185', 'user185@example.com'),
('user186', 'user186@example.com'),
('user187', 'user187@example.com'),
('user188', 'user188@example.com'),
('user189', 'user189@example.com'),
('user190', 'user190@example.com'),
('user191', 'user191@example.com'),
('user192', 'user192@example.com'),
('user193', 'user193@example.com'),
('user194', 'user194@example.com'),
('user195', 'user195@example.com'),
('user196', 'user196@example.com'),
('user197', 'user197@example.com'),
('user198', 'user198@example.com'),
('user199', 'user199@example.com'),
('user200', 'user200@example.com');

-- Insert 200 seats for the movie (matching the exact schema from screenshots)
INSERT INTO seats (name, movie_id, user_id) VALUES
('Seat-1', 1, NULL), ('Seat-2', 1, NULL), ('Seat-3', 1, NULL), ('Seat-4', 1, NULL), ('Seat-5', 1, NULL),
('Seat-6', 1, NULL), ('Seat-7', 1, NULL), ('Seat-8', 1, NULL), ('Seat-9', 1, NULL), ('Seat-10', 1, NULL),
('Seat-11', 1, NULL), ('Seat-12', 1, NULL), ('Seat-13', 1, NULL), ('Seat-14', 1, NULL), ('Seat-15', 1, NULL),
('Seat-16', 1, NULL), ('Seat-17', 1, NULL), ('Seat-18', 1, NULL), ('Seat-19', 1, NULL), ('Seat-20', 1, NULL),
('Seat-21', 1, NULL), ('Seat-22', 1, NULL), ('Seat-23', 1, NULL), ('Seat-24', 1, NULL), ('Seat-25', 1, NULL),
('Seat-26', 1, NULL), ('Seat-27', 1, NULL), ('Seat-28', 1, NULL), ('Seat-29', 1, NULL), ('Seat-30', 1, NULL),
('Seat-31', 1, NULL), ('Seat-32', 1, NULL), ('Seat-33', 1, NULL), ('Seat-34', 1, NULL), ('Seat-35', 1, NULL),
('Seat-36', 1, NULL), ('Seat-37', 1, NULL), ('Seat-38', 1, NULL), ('Seat-39', 1, NULL), ('Seat-40', 1, NULL),
('Seat-41', 1, NULL), ('Seat-42', 1, NULL), ('Seat-43', 1, NULL), ('Seat-44', 1, NULL), ('Seat-45', 1, NULL),
('Seat-46', 1, NULL), ('Seat-47', 1, NULL), ('Seat-48', 1, NULL), ('Seat-49', 1, NULL), ('Seat-50', 1, NULL),
('Seat-51', 1, NULL), ('Seat-52', 1, NULL), ('Seat-53', 1, NULL), ('Seat-54', 1, NULL), ('Seat-55', 1, NULL),
('Seat-56', 1, NULL), ('Seat-57', 1, NULL), ('Seat-58', 1, NULL), ('Seat-59', 1, NULL), ('Seat-60', 1, NULL),
('Seat-61', 1, NULL), ('Seat-62', 1, NULL), ('Seat-63', 1, NULL), ('Seat-64', 1, NULL), ('Seat-65', 1, NULL),
('Seat-66', 1, NULL), ('Seat-67', 1, NULL), ('Seat-68', 1, NULL), ('Seat-69', 1, NULL), ('Seat-70', 1, NULL),
('Seat-71', 1, NULL), ('Seat-72', 1, NULL), ('Seat-73', 1, NULL), ('Seat-74', 1, NULL), ('Seat-75', 1, NULL),
('Seat-76', 1, NULL), ('Seat-77', 1, NULL), ('Seat-78', 1, NULL), ('Seat-79', 1, NULL), ('Seat-80', 1, NULL),
('Seat-81', 1, NULL), ('Seat-82', 1, NULL), ('Seat-83', 1, NULL), ('Seat-84', 1, NULL), ('Seat-85', 1, NULL),
('Seat-86', 1, NULL), ('Seat-87', 1, NULL), ('Seat-88', 1, NULL), ('Seat-89', 1, NULL), ('Seat-90', 1, NULL),
('Seat-91', 1, NULL), ('Seat-92', 1, NULL), ('Seat-93', 1, NULL), ('Seat-94', 1, NULL), ('Seat-95', 1, NULL),
('Seat-96', 1, NULL), ('Seat-97', 1, NULL), ('Seat-98', 1, NULL), ('Seat-99', 1, NULL), ('Seat-100', 1, NULL),
('Seat-101', 1, NULL), ('Seat-102', 1, NULL), ('Seat-103', 1, NULL), ('Seat-104', 1, NULL), ('Seat-105', 1, NULL),
('Seat-106', 1, NULL), ('Seat-107', 1, NULL), ('Seat-108', 1, NULL), ('Seat-109', 1, NULL), ('Seat-110', 1, NULL),
('Seat-111', 1, NULL), ('Seat-112', 1, NULL), ('Seat-113', 1, NULL), ('Seat-114', 1, NULL), ('Seat-115', 1, NULL),
('Seat-116', 1, NULL), ('Seat-117', 1, NULL), ('Seat-118', 1, NULL), ('Seat-119', 1, NULL), ('Seat-120', 1, NULL),
('Seat-121', 1, NULL), ('Seat-122', 1, NULL), ('Seat-123', 1, NULL), ('Seat-124', 1, NULL), ('Seat-125', 1, NULL),
('Seat-126', 1, NULL), ('Seat-127', 1, NULL), ('Seat-128', 1, NULL), ('Seat-129', 1, NULL), ('Seat-130', 1, NULL),
('Seat-131', 1, NULL), ('Seat-132', 1, NULL), ('Seat-133', 1, NULL), ('Seat-134', 1, NULL), ('Seat-135', 1, NULL),
('Seat-136', 1, NULL), ('Seat-137', 1, NULL), ('Seat-138', 1, NULL), ('Seat-139', 1, NULL), ('Seat-140', 1, NULL),
('Seat-141', 1, NULL), ('Seat-142', 1, NULL), ('Seat-143', 1, NULL), ('Seat-144', 1, NULL), ('Seat-145', 1, NULL),
('Seat-146', 1, NULL), ('Seat-147', 1, NULL), ('Seat-148', 1, NULL), ('Seat-149', 1, NULL), ('Seat-150', 1, NULL),
('Seat-151', 1, NULL), ('Seat-152', 1, NULL), ('Seat-153', 1, NULL), ('Seat-154', 1, NULL), ('Seat-155', 1, NULL),
('Seat-156', 1, NULL), ('Seat-157', 1, NULL), ('Seat-158', 1, NULL), ('Seat-159', 1, NULL), ('Seat-160', 1, NULL),
('Seat-161', 1, NULL), ('Seat-162', 1, NULL), ('Seat-163', 1, NULL), ('Seat-164', 1, NULL), ('Seat-165', 1, NULL),
('Seat-166', 1, NULL), ('Seat-167', 1, NULL), ('Seat-168', 1, NULL), ('Seat-169', 1, NULL), ('Seat-170', 1, NULL),
('Seat-171', 1, NULL), ('Seat-172', 1, NULL), ('Seat-173', 1, NULL), ('Seat-174', 1, NULL), ('Seat-175', 1, NULL),
('Seat-176', 1, NULL), ('Seat-177', 1, NULL), ('Seat-178', 1, NULL), ('Seat-179', 1, NULL), ('Seat-180', 1, NULL),
('Seat-181', 1, NULL), ('Seat-182', 1, NULL), ('Seat-183', 1, NULL), ('Seat-184', 1, NULL), ('Seat-185', 1, NULL),
('Seat-186', 1, NULL), ('Seat-187', 1, NULL), ('Seat-188', 1, NULL), ('Seat-189', 1, NULL), ('Seat-190', 1, NULL),
('Seat-191', 1, NULL), ('Seat-192', 1, NULL), ('Seat-193', 1, NULL), ('Seat-194', 1, NULL), ('Seat-195', 1, NULL),
('Seat-196', 1, NULL), ('Seat-197', 1, NULL), ('Seat-198', 1, NULL), ('Seat-199', 1, NULL), ('Seat-200', 1, NULL);

-- Show the data
SELECT 'Users count:' as info, COUNT(*) as count FROM users
UNION ALL
SELECT 'Seats count:', COUNT(*) FROM seats
UNION ALL
SELECT 'Movies count:', COUNT(*) FROM movies; 